import {
  ApolloError
} from "./chunk-3G2D5O2S.js";
import {
  ApolloLink
} from "./chunk-VH2LDFWI.js";
import {
  Observable,
  isNonNullObject,
  print
} from "./chunk-2F67BI3B.js";
import "./chunk-7JBOZ6F6.js";
import {
  __assign,
  __extends
} from "./chunk-XPHO4OZ7.js";
import "./chunk-V4OQ3NZ2.js";

// ../../node_modules/.pnpm/@apollo+client@3.14.0_@types+react@18.2.45_graphql-ws@6.0.6_graphql@16.12.0__graphql@16_7911829724461517ff2d5dcf613c28a8/node_modules/@apollo/client/link/subscriptions/index.js
function isLikeCloseEvent(val) {
  return isNonNullObject(val) && "code" in val && "reason" in val;
}
function isLikeErrorEvent(err) {
  var _a;
  return isNonNullObject(err) && ((_a = err.target) === null || _a === void 0 ? void 0 : _a.readyState) === WebSocket.CLOSED;
}
var GraphQLWsLink = (
  /** @class */
  (function(_super) {
    __extends(GraphQLWsLink2, _super);
    function GraphQLWsLink2(client) {
      var _this = _super.call(this) || this;
      _this.client = client;
      return _this;
    }
    GraphQLWsLink2.prototype.request = function(operation) {
      var _this = this;
      return new Observable(function(observer) {
        return _this.client.subscribe(__assign(__assign({}, operation), { query: print(operation.query) }), {
          next: observer.next.bind(observer),
          complete: observer.complete.bind(observer),
          error: function(err) {
            if (err instanceof Error) {
              return observer.error(err);
            }
            var likeClose = isLikeCloseEvent(err);
            if (likeClose || isLikeErrorEvent(err)) {
              return observer.error(
                // reason will be available on clean closes
                new Error("Socket closed".concat(likeClose ? " with event ".concat(err.code) : "").concat(likeClose ? " ".concat(err.reason) : ""))
              );
            }
            return observer.error(new ApolloError({
              graphQLErrors: Array.isArray(err) ? err : [err]
            }));
          }
          // casting around a wrong type in graphql-ws, which incorrectly expects `Sink<ExecutionResult>`
        });
      });
    };
    return GraphQLWsLink2;
  })(ApolloLink)
);
export {
  GraphQLWsLink
};
//# sourceMappingURL=@apollo_client_link_subscriptions.js.map
