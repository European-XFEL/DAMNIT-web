{
  "version": 3,
  "sources": ["../../../../../node_modules/.pnpm/@apollo+client@3.14.0_@types+react@18.2.45_graphql-ws@6.0.6_graphql@16.12.0__graphql@16_7911829724461517ff2d5dcf613c28a8/node_modules/@apollo/src/link/remove-typename/removeTypenameFromVariables.ts"],
  "sourcesContent": ["import { wrap } from \"optimism\";\nimport type { DocumentNode, TypeNode } from \"graphql\";\nimport { Kind, visit } from \"graphql\";\nimport { ApolloLink } from \"../core/index.js\";\nimport {\n  stripTypename,\n  isPlainObject,\n  cacheSizes,\n  defaultCacheSizes,\n} from \"../../utilities/index.js\";\nimport type { OperationVariables } from \"../../core/index.js\";\nimport { WeakCache } from \"@wry/caches\";\n\nexport const KEEP = \"__KEEP\";\n\ninterface KeepTypenameConfig {\n  [key: string]: typeof KEEP | KeepTypenameConfig;\n}\n\nexport interface RemoveTypenameFromVariablesOptions {\n  except?: KeepTypenameConfig;\n}\n\nexport function removeTypenameFromVariables(\n  options: RemoveTypenameFromVariablesOptions = Object.create(null)\n) {\n  return Object.assign(\n    new ApolloLink((operation, forward) => {\n      const { except } = options;\n      const { query, variables } = operation;\n\n      if (variables) {\n        operation.variables =\n          except ?\n            maybeStripTypenameUsingConfig(query, variables, except)\n          : stripTypename(variables);\n      }\n\n      return forward(operation);\n    }),\n    __DEV__ ?\n      {\n        getMemoryInternals() {\n          return {\n            removeTypenameFromVariables: {\n              getVariableDefinitions: getVariableDefinitions?.size ?? 0,\n            },\n          };\n        },\n      }\n    : {}\n  );\n}\n\nfunction maybeStripTypenameUsingConfig(\n  query: DocumentNode,\n  variables: OperationVariables,\n  config: KeepTypenameConfig\n) {\n  const variableDefinitions = getVariableDefinitions(query);\n\n  return Object.fromEntries(\n    Object.entries(variables).map((keyVal) => {\n      const [key, value] = keyVal;\n      const typename = variableDefinitions[key];\n      const typenameConfig = config[typename];\n\n      keyVal[1] =\n        typenameConfig ?\n          maybeStripTypename(value, typenameConfig)\n        : stripTypename(value);\n\n      return keyVal;\n    })\n  );\n}\n\ntype JSONPrimitive = string | number | null | boolean;\ntype JSONValue = JSONPrimitive | JSONValue[] | { [key: string]: JSONValue };\n\nfunction maybeStripTypename(\n  value: JSONValue,\n  config: KeepTypenameConfig[string]\n): JSONValue {\n  if (config === KEEP) {\n    return value;\n  }\n\n  if (Array.isArray(value)) {\n    return value.map((item) => maybeStripTypename(item, config));\n  }\n\n  if (isPlainObject(value)) {\n    const modified: Record<string, any> = {};\n\n    Object.keys(value).forEach((key) => {\n      const child = value[key];\n\n      if (key === \"__typename\") {\n        return;\n      }\n\n      const fieldConfig = config[key];\n\n      modified[key] =\n        fieldConfig ?\n          maybeStripTypename(child, fieldConfig)\n        : stripTypename(child);\n    });\n\n    return modified;\n  }\n\n  return value;\n}\n\nconst getVariableDefinitions = wrap(\n  (document: DocumentNode) => {\n    const definitions: Record<string, string> = {};\n\n    visit(document, {\n      VariableDefinition(node) {\n        definitions[node.variable.name.value] = unwrapType(node.type);\n      },\n    });\n\n    return definitions;\n  },\n  {\n    max:\n      cacheSizes[\"removeTypenameFromVariables.getVariableDefinitions\"] ||\n      defaultCacheSizes[\"removeTypenameFromVariables.getVariableDefinitions\"],\n    cache: WeakCache,\n  }\n);\n\nfunction unwrapType(node: TypeNode): string {\n  switch (node.kind) {\n    case Kind.NON_NULL_TYPE:\n      return unwrapType(node.type);\n    case Kind.LIST_TYPE:\n      return unwrapType(node.type);\n    case Kind.NAMED_TYPE:\n      return node.name.value;\n  }\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAaO,IAAM,OAAO;AAUd,SAAU,4BACd,SAAiE;AAAjE,MAAA,YAAA,QAAA;AAAA,cAA8C,uBAAO,OAAO,IAAI;EAAC;AAEjE,SAAO,OAAO,OACZ,IAAI,WAAW,SAAC,WAAW,SAAO;AACxB,QAAA,SAAW,QAAO;AAClB,QAAA,QAAqB,UAAS,OAAvB,YAAc,UAAS;AAEtC,QAAI,WAAW;AACb,gBAAU,YACR,SACE,8BAA8B,OAAO,WAAW,MAAM,IACtD,cAAc,SAAS;IAC7B;AAEA,WAAO,QAAQ,SAAS;EAC1B,CAAC,GACD,WAAS,YAAA,QACP;IACE,oBAAkB,WAAA;;AAChB,aAAO;QACL,6BAA6B;UAC3B,yBAAwB,KAAA,2BAAsB,QAAtB,2BAAsB,SAAA,SAAtB,uBAAwB,UAAI,QAAA,OAAA,SAAA,KAAI;;;IAG9D;MAEF,CAAA,CAAE;AAER;AAEA,SAAS,8BACP,OACA,WACA,QAA0B;AAE1B,MAAM,sBAAsB,uBAAuB,KAAK;AAExD,SAAO,OAAO,YACZ,OAAO,QAAQ,SAAS,EAAE,IAAI,SAAC,QAAM;AAC5B,QAAA,MAAc,OAAM,CAAA,GAAf,QAAS,OAAM,CAAA;AAC3B,QAAM,WAAW,oBAAoB,GAAG;AACxC,QAAM,iBAAiB,OAAO,QAAQ;AAEtC,WAAO,CAAC,IACN,iBACE,mBAAmB,OAAO,cAAc,IACxC,cAAc,KAAK;AAEvB,WAAO;EACT,CAAC,CAAC;AAEN;AAKA,SAAS,mBACP,OACA,QAAkC;AAElC,MAAI,WAAW,MAAM;AACnB,WAAO;EACT;AAEA,MAAI,MAAM,QAAQ,KAAK,GAAG;AACxB,WAAO,MAAM,IAAI,SAAC,MAAI;AAAK,aAAA,mBAAmB,MAAM,MAAM;IAA/B,CAAgC;EAC7D;AAEA,MAAI,cAAc,KAAK,GAAG;AACxB,QAAM,aAAgC,CAAA;AAEtC,WAAO,KAAK,KAAK,EAAE,QAAQ,SAAC,KAAG;AAC7B,UAAM,QAAQ,MAAM,GAAG;AAEvB,UAAI,QAAQ,cAAc;AACxB;MACF;AAEA,UAAM,cAAc,OAAO,GAAG;AAE9B,iBAAS,GAAG,IACV,cACE,mBAAmB,OAAO,WAAW,IACrC,cAAc,KAAK;IACzB,CAAC;AAED,WAAO;EACT;AAEA,SAAO;AACT;AAEA,IAAM,yBAAyB,KAC7B,SAAC,UAAsB;AACrB,MAAM,cAAsC,CAAA;AAE5C,QAAM,UAAU;IACd,oBAAkB,SAAC,MAAI;AACrB,kBAAY,KAAK,SAAS,KAAK,KAAK,IAAI,WAAW,KAAK,IAAI;IAC9D;GACD;AAED,SAAO;AACT,GACA;EACE,KACE,WAAW,oDAAoD;EAEjE,OAAO;CACR;AAGH,SAAS,WAAW,MAAc;AAChC,UAAQ,KAAK,MAAM;IACjB,KAAK,KAAK;AACR,aAAO,WAAW,KAAK,IAAI;IAC7B,KAAK,KAAK;AACR,aAAO,WAAW,KAAK,IAAI;IAC7B,KAAK,KAAK;AACR,aAAO,KAAK,KAAK;EACrB;AACF;",
  "names": []
}
