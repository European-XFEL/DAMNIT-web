import {
  ApolloLink
} from "./chunk-VH2LDFWI.js";
import {
  WeakCache,
  cacheSizes,
  isPlainObject,
  stripTypename,
  wrap
} from "./chunk-2F67BI3B.js";
import {
  Kind,
  visit
} from "./chunk-7JBOZ6F6.js";
import "./chunk-XPHO4OZ7.js";
import "./chunk-V4OQ3NZ2.js";

// ../../node_modules/.pnpm/@apollo+client@3.14.0_@types+react@18.2.45_graphql-ws@6.0.6_graphql@16.12.0__graphql@16_7911829724461517ff2d5dcf613c28a8/node_modules/@apollo/client/link/remove-typename/removeTypenameFromVariables.js
var KEEP = "__KEEP";
function removeTypenameFromVariables(options) {
  if (options === void 0) {
    options = /* @__PURE__ */ Object.create(null);
  }
  return Object.assign(new ApolloLink(function(operation, forward) {
    var except = options.except;
    var query = operation.query, variables = operation.variables;
    if (variables) {
      operation.variables = except ? maybeStripTypenameUsingConfig(query, variables, except) : stripTypename(variables);
    }
    return forward(operation);
  }), globalThis.__DEV__ !== false ? {
    getMemoryInternals: function() {
      var _a;
      return {
        removeTypenameFromVariables: {
          getVariableDefinitions: (_a = getVariableDefinitions === null || getVariableDefinitions === void 0 ? void 0 : getVariableDefinitions.size) !== null && _a !== void 0 ? _a : 0
        }
      };
    }
  } : {});
}
function maybeStripTypenameUsingConfig(query, variables, config) {
  var variableDefinitions = getVariableDefinitions(query);
  return Object.fromEntries(Object.entries(variables).map(function(keyVal) {
    var key = keyVal[0], value = keyVal[1];
    var typename = variableDefinitions[key];
    var typenameConfig = config[typename];
    keyVal[1] = typenameConfig ? maybeStripTypename(value, typenameConfig) : stripTypename(value);
    return keyVal;
  }));
}
function maybeStripTypename(value, config) {
  if (config === KEEP) {
    return value;
  }
  if (Array.isArray(value)) {
    return value.map(function(item) {
      return maybeStripTypename(item, config);
    });
  }
  if (isPlainObject(value)) {
    var modified_1 = {};
    Object.keys(value).forEach(function(key) {
      var child = value[key];
      if (key === "__typename") {
        return;
      }
      var fieldConfig = config[key];
      modified_1[key] = fieldConfig ? maybeStripTypename(child, fieldConfig) : stripTypename(child);
    });
    return modified_1;
  }
  return value;
}
var getVariableDefinitions = wrap(function(document) {
  var definitions = {};
  visit(document, {
    VariableDefinition: function(node) {
      definitions[node.variable.name.value] = unwrapType(node.type);
    }
  });
  return definitions;
}, {
  max: cacheSizes["removeTypenameFromVariables.getVariableDefinitions"] || 2e3,
  cache: WeakCache
});
function unwrapType(node) {
  switch (node.kind) {
    case Kind.NON_NULL_TYPE:
      return unwrapType(node.type);
    case Kind.LIST_TYPE:
      return unwrapType(node.type);
    case Kind.NAMED_TYPE:
      return node.name.value;
  }
}
export {
  KEEP,
  removeTypenameFromVariables
};
//# sourceMappingURL=@apollo_client_link_remove-typename.js.map
